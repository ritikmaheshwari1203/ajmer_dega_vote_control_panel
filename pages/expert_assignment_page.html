<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello, world!</title>
    <script type="module" src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body class="bg-gray-100 overflow-x-hidden">

    <div id="loader" class="hidden fixed backdrop-blur-md top-0 w-[100vw]  z-[40] h-[100vh]  flex justify-center items-center">
        <div class="loader"></div>
    </div>

    <header class="overflow-hidden bg-[#161679] text-white h-fit w-full">
        <nav class="flex justify-between items-center overflow-hidden">
            <div class="md:pr-[2rem] pt-4 md:pt-0 pb-4 md:pb-0   flex justify-center items-center">
                <img class="w-[8rem] h-[8rem] object-fill rounded-full overflow-hidden"
                    src="https://ajmerdegavote.in/assets/logo.6bb985f0.png" alt="" srcset="" />
                <span>
                    <h2 class=" md:text-xl font-bold">बसंता की मनुहार, वोट देवो नर-नार</h2>
                    <h2 class=" font-bold">जिला अजमेर</h2>
                    <h1 class=" font-bold">DISTRICT AJMER</h1>
                    <h1 id="" class="blinkText font-bold backdrop-blur-sm md:text-xl">मतदान तिथि - 25 नवम्बर, 2023</h1>
                </span>

            </div>
            <div class="md:hidden h-full flex items-center pr-2">
                <button id="navbar-toggle"
                    class="rounded-md bg-gradient-to-r from-green-400 to-blue-500 hover:from-pink-500 hover:to-yellow-500 focus:outline-none">
                    <svg class="w-8 h-8 m-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7">
                        </path>
                    </svg>
                </button>
            </div>
            <!-- <div class="md:hidden text-black text-2xl">
                    <ion-icon name="menu" onclick="change(this)"></ion-icon>
                </div> -->
            <ul
                class="absolute md:pr-[2rem] font-bold top-[-150px] md:top-0 font-serif md:static md:flex md:space-x-9 text-white md:items-center transition-all ease-in duration-500 md:w-fit md:text-2xl">
                <li class="md:hover:scale-125 md:ease-out duration-500 cursor-pointer">
                    <a href="../api/logout.php"> Logout </a>
                </li>

                <!-- <li class="md:hover:scale-125 md:ease-out duration-500 cursor-pointer">
              <a href="signup.html"> Signup </a>
            </li> -->
            </ul>
        </nav>
        <div id="navbar-menu"
            class="bg-gray-300 text-black bg-opacity-50 z-[10] absolute w-[100vw] translate-y-[-250px] opacity-0 duration-200 md:hidden shadow-xl p-4 backdrop-blur-sm">
            <a href="../api/logout.php"> Logout </a>
            <!-- <a href="signup.html" class="block mb-2 cursor-pointer">Signup</a> -->
        </div>
    </header>

    <section
        class=" hidden w-[100vw] h-[100vh] fixed top-0 flex flex-col justify-center items-center  z-10 backdrop-blur-md"
        id="Markspopup">
        <div class="w-[90%] h-[10%] overflow-hidden rounded-lg flex justify-between bg-gray-300">
            <div class="h-full text-3xl p-2 flex justify-center items-center">
                <h1 id="totalmarks">Total Marks : </h1>
            </div>
            <div class="h-full hover:bg-slate-400 duration-700 text-5xl cursor-pointer flex justify-center items-center p-2 "
                onclick="Close()"><ion-icon name="close"></ion-icon></div>
        </div>
        <div class="w-[90%] h-[86%] bg-gray-200 overflow-hidden rounded-lg flex justify-between">
            <div class="w-[60%]  h-[95%] " id="file_show">


            </div>
            <div class="w-[35%]  h-[95%] box-border p-5">
                <form>
                    <div class="my-3 ">
                        <div>
                            <h1>
                                रचनात्मकता के अंक 25 में से
                            </h1>
                        </div>
                        <input type="number" min="0" maxlength="2" max="25" oninput="changemarks()" value="0"
                            id="marks1" placeholder="रचनात्मकता के अंक"
                            class="border-2 pl-2 text-center outline-red-600 w-full h-[4rem] rounded-lg border-black/10"
                            required>
                    </div>
                    <div class="my-3 ">
                        <div>
                            <h1>
                                प्रभावशीलता के अंक 25 में से
                            </h1>
                        </div>
                        <input type="number" oninput="changemarks()" min="0" maxlength="2" max="25" value="0"
                            id="marks2" placeholder="प्रभावशीलता के अंक"
                            class="border-2 pl-2 text-center outline-red-600 w-full h-[4rem] rounded-lg border-black/10"
                            required>
                    </div>
                    <div class="my-3 ">
                        <div>
                            <h1>
                                दृश्यता के अंक 25 में से
                            </h1>
                        </div>
                        <input type="number" value="0" min="0" maxlength="2" max="25" oninput="changemarks()"
                            id="marks3" placeholder="दृश्यता के अंक"
                            class="border-2 pl-2 text-center outline-red-600 w-full h-[4rem] rounded-lg border-black/10"
                            required>
                    </div>
                    <div class="my-3 ">
                        <div>
                            <h1>
                                उद्देश्य आधारित के अंक 25 में से
                            </h1>
                        </div>
                        <input type="number" oninput="changemarks()" value="0" id="marks4"
                            placeholder="उद्देश्य आधारित के अंक"
                            class="border-2 pl-2 text-center outline-red-600 w-full h-[4rem] rounded-lg border-black/10"
                            required>
                    </div>


                    <button type="button"
                        class="mt-2 w-fit  p-2 text-center pl-4 pr-4 rounded-xl text-white text-xl bg-gradient-to-r from-green-400 to-blue-500 hover:from-pink-500 hover:to-yellow-500"
                        onclick="SavedMarks()">Submit</button>
                </form>
            </div>

        </div>

    </section>

    <div class="w-[80vw] mx-auto" style="margin-top: 10px;">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-800 text-white">
                <tr>
                    <th class="px-6 py-3 text-left">Competition Name</th>
                    <th class="px-6 py-3 text-left">Vidhansabha</th>
                    <th class="px-6 py-3 text-left">File Link</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="result">

            </tbody>
        </table>
    </div>

    <section id="alert"
        class="duration-300 z-[20] ease-in-out   translate-y-[-20rem]  flex justify-center items-center fixed top-0  w-full h-[6rem]">
        <div
            class="w-[85%] text-center font-bold overflow-hidden h-[80%] p-1 bg-gray-300 bg-opacity-50  backdrop-blur-lg rounded-lg  md:w-[40%] flex items-center justify-center">
            <p id="alerttext" class=" text-2xl"></p>
        </div>

    </section>

    <script>
        var global_file_id;

        var global_vidhanSbha,global_Cname;

        function Close() {
            let Markspopup = document.getElementById("Markspopup")
            let totalmarks = document.getElementById("totalmarks")
            document.getElementById("marks1").value = 0
                    document.getElementById("marks2").value = 0
                    document.getElementById("marks3").value = 0
                    document.getElementById("marks4").value = 0
            totalmarks.innerText=`Total Marks :`;
            Markspopup.classList.toggle("hidden")
        }

        function ShowHideloader() {

            let loader = document.getElementById("loader")
            loader.classList.toggle("hidden")
            
        }

        function searchResult() {
            ShowHideloader()
            let result = document.getElementById("result");
            let html = "";
            fetch("../secondstage/assigned_work.php").then(function (response) {
                return response.json()
            }).then(function (data) {
                // console.log(data);
                if (data == "NonvalidUser") {
                    ShowHideloader()
                    location.href = "./expert_login.html"
                }

                if (data == "Null") {
                    ShowHideloader()
                    result.innerHTML = html;
                }
                else {

                    // let result = document.getElementById("result")

                    let file_id = data[0];
                    let file_path = data[1];
                    let html = ""

                    for (let index = 0; index < file_path.length; index++) {
                        // const element = file_path[index];
                        // console.log(file_path[index]);
                        // html = ``
                        html = html + `<tr class="hover:bg-gray-300 duration-400">
                    <td class="px-6 py-4 whitespace-nowrap">${file_path[index][0]}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${file_path[index][1]}</td>
                    <td class="font-bold cursor-pointer px-6 py-4 whitespace-nowrap" onclick="Showfile('${file_path[index][0]}','${file_path[index][1]}','${file_path[index][2]}', ${file_id[index]})">Click here</td>
                    </tr> `

                    }
                    result.innerHTML = html;
                    ShowHideloader()

                }



            })

        }

        function Showfile(Cname, vidhanSbha, file_name, file_id) {
            let path = document.getElementById("file_show");
            let html = `<object data="https://ajmerdegavote.in/uploads/${Cname}/${vidhanSbha}/${file_name}"
                    width="100%" height="100%">
                </object>`

            path.innerHTML = html;

            let Markspopup = document.getElementById("Markspopup")
            Markspopup.classList.toggle("hidden")
            global_file_id = file_id;
            global_Cname = Cname;
            global_vidhanSbha = vidhanSbha;

        }

        function changemarks() {

            let marks1 = parseInt(document.getElementById("marks1").value)
            let marks2 = parseInt(document.getElementById("marks2").value)
            let marks3 = parseInt(document.getElementById("marks3").value)
            let marks4 = parseInt(document.getElementById("marks4").value)
            let totalmarks = document.getElementById("totalmarks")

            totalmarks.innerText = `Total Marks : ${marks1 + marks2 + marks3 + marks4}`;
        }

        function SavedMarks() {
            // ShowHideloader()
            let malert = document.getElementById("alert")
            let alerttext = document.getElementById("alerttext")
            // console.log("global=",global_file_id);
            let marks1 = parseInt(document.getElementById("marks1").value)
            let marks2 = parseInt(document.getElementById("marks2").value)
            let marks3 = parseInt(document.getElementById("marks3").value)
            let marks4 = parseInt(document.getElementById("marks4").value)


            if (marks1 > 25 || marks2 > 25 || marks3 > 25 || marks4 > 25) {

                alerttext.innerText = "Please!!! Assign Numbers Below 25 "
                malert.classList.toggle("translate-y-[-20rem]")
                setTimeout(() => {
                    malert.classList.toggle("translate-y-[-20rem]")
                }, 2500);
                // ShowHideloader()

            }


            else {

            if((marks1 + marks2 + marks3 + marks4)==0){
                alerttext.innerText = "Please!!! Give Atleast One Mark. "
                malert.classList.toggle("translate-y-[-20rem]")
                setTimeout(() => {
                    malert.classList.toggle("translate-y-[-20rem]")
                }, 2500);
            }

            else{

            

                ShowHideloader()

                let totalMarks = parseInt(marks1 + marks2 + marks3 + marks4);


                param = {
                    'TotalMarks': totalMarks,
                    'file_id': parseInt(global_file_id),
                    'vidhanSbha': global_vidhanSbha,
                    'Cname':global_Cname
                }

                let Jsondata = JSON.stringify(param)

                obj = {
                    method: 'post',
                    header: {
                        'Content-Type': 'application/json'
                    },
                    body: Jsondata
                }

                fetch("../secondstage/SubmitMarks.php", obj).then(function (response) {
                    return response.json()
                }).then(function (data) {
                    searchResult()
                    ShowHideloader()
                    // location.href
                    alerttext.innerText = "Assigned Marks SuccessFully!!! "
                    malert.classList.toggle("translate-y-[-20rem]")
                    setTimeout(() => {
                        malert.classList.toggle("translate-y-[-20rem]")
                    }, 2500);

                    Close()

                })

            }

            }



        }

        searchResult()
    </script>
</body>

</html>